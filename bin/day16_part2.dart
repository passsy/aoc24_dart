// https://adventofcode.com/2024/day/16
import 'package:aoc24/grid.dart';

void solveDay16(String input) {
  List<Point> tiles = [];
  final grid = AocGrid<Node>(
      data: input,
      mapPoint: (it, point) {
        return switch (it) {
          '#' => Wall(),
          '.' => Path(),
          'S' => Path()..start = true,
          'E' => Path()..end = true,
          _ => throw ArgumentError('Unknown character $it')
        };
      },
      pointToString: (it, point) {
        if (it is Path) {
          if (it.start) {
            return 'S';
          } else if (it.end) {
            return 'E';
          } else {
            final onPath = tiles;
            if (onPath.contains(point)) {
              return 'O';
            }
            return '.';
          }
        }
        return '#';
      });

  final pathTiles = grid
      .getAllGridPoints()
      .where((it) => it.value is Path)
      .map((it) => it as GridPoint<Path>)
      .toList();
  final start = pathTiles.firstWhere((it) => it.value!.start);
  final end = pathTiles.firstWhere((it) => it.value!.end);

  int pathCost(List<GridPoint<Node>> path) {
    if (path.length == 1) {
      return 0;
    }
    if (path.length == 2) {
      return 1;
    }
    int cost = path.length - 1;
    for (int i = 0; i < path.length - 2; i++) {
      final current = path[i];
      final next = path[i + 1];
      final next2 = path[i + 2];

      final onlyVertical =
          current.point.y == next.point.y && next.point.y == next2.point.y;
      final onlyHorizontal =
          current.point.x == next.point.x && next.point.x == next2.point.x;
      if (onlyHorizontal || onlyVertical) {
        // no rotation
      } else {
        cost += 1000;
      }
    }
    return cost;
  }

  final path = grid.findFastestPath(
    start.point,
    end.point,
    isPath: (it) => it.value is Path,
    cost: (path) => pathCost(path),
  );
  print('Found path of length ${path!.length}');
  final cheapestPath = pathCost(path);
  print('cheapestPath cost ${cheapestPath}');
  tiles = path.map((it) => it.point).toList();

  grid.printToConsole();
  // #############################################################################################################################################
  // #...........#.......#.........#.........#.........#.............#...........#...#.......#.....#.......#.......#.......#.....#.........#....O#
  // #.#########.#####.#.#######.#.###.#.###.#.#####.###.#.#########.#.#.#######.#.#.#####.#.###.#.#.#####.#.#.###.#####.#.#.###.#.#######.#.###O#
  // #.............#...#.........#...#.#.#.....#...#.#...#.#.......#...#.#.....#...#.......#...#.........#.#.#...#.......#...#...#...#...#.#...#O#
  // #########.###.#.###.#######.###.#.#.#.#####.#.#.#.###.#.#########.#.#.###.###########.###.#.#######.#.#####.###########.#.###.#.#.#.#.#.#.#O#
  // #.......#.#...#...#.#...#.....#.#.#.#.#...#.#...#...#.#.........#.#.#.....................#.....#...#...................#...#.#.#.#.#.#.#.#O#
  // #.#####.#.#.###.#.###.#.#.#.###.###.###.#.#########.#.#.#####.#.#.#.#.#.###.###.#.#.#.#.#.#.###.#.#.#####.#.#.#####.#.#.###.#.#.###.#.#.#.#O#
  // #...#.....#.#.#.#.....#.#.#...#...#.....#...........#.#.#...#.#.#.#.#.#...#...#.#.#.#.#...#...#.#.#...#...#.#.#...#...#.#.#.#.#...#...#.#.#O#
  // #.#.#######.#.#.###.#.#.###.#.###.#.#####.###########.#.###.#.###.#.#.#.#####.#.#.#.#.#########.#.#####.###.#.###.#####.#.#.#.###.#.###.#.#O#
  // #.#...#...#.#...#...#.#.............#...#...#.......#.#.....#...#...#...#.....#.#...#.......#...#...#...#...#.....#............OOOOOOOOOOOOO#
  // #.###.#.###.#####.#.#.#.#.#.#.#.#####.#.#####.#####.#.#####.###.#.#####.#.###.#.#####.###.#.#.#####.#.###.###.###.#.###.#.###.#O#####.#####.#
  // #...#.#.#...#.....#.....#.#...#.#.....#.......#...#.#...#...#.#...#.............#.........#...#.....#.#...........#.#.....#...#O#.#...#...#.#
  // #####.#.#.###.#######.###.#.###.#.#############.###.###.#.###.#.#.#####.#.###.#.#.###.#########.#.#.#.#.#####.#####.#.#########O#.#.###.#.###
  // #.....#.#.#...#...........#...#...#...........#.....#...#.....#.#.....#.#...#.#.#.#...#.....#.#.#.....................#..OOOOOOO#.#.#...#...#
  // #.#####.#.#.#.###.###.#.###########.#######.###.#####.#######.#.#####.#####.###.###.#.###.#.#.#.#.###.#.#####.#######.###O#######.#.#.#####.#
  // #...#...#.#.#...#.#...#.#.........#.#.#...#.#...#.....#.....#.#.#...#.....#...#.....#.....#.#...#...#.#...#.......#...#OOO#OOO#.....#.#...#.#
  // #.#.###.#.#.###.#.#.#.#.#.#####.###.#.#.#.#.#.#######.#.#####.#.#.#####.#.###.#######.#####.#.#####.#.#.#.#.#####.#.###O###O#O#######.###.#.#
  // #.#.#...#.#.#...#.#.#...#.....#.......#.#...#.....#...#.......#.#.#.............#.#...#...#.#.#.....#.#.#.#.....#.#...#OOOOO#O#...........#.#
  // #.#.#.###.#.#.#####.#####.#####.#####.#.###.#####.#.###########.#.#.###########.#.#.#.#.###.#.#.###.#.###.#.###.#.###.#######O#.###########.#
  // #.#.#.#...#.#...#...#.....#...#.#...#.#.#.#.#...#...#...........#.#.#.#...#...#.#...#.#.#...#.#...#.#...#.#...#.#...#.#OOOOOOO#.....#.......#
  // ###.#.#.###.###.#.###.#####.#.###.#.###.#.#.#.#.#####.#.#########.#.#.#.#.#.#.#.#.###.#.#.#######.#.###.#.###.#.###.#.#O#.#########.#.#####.#
  // #...#...#...#...#.....#...#.#.....#.....#...#.#.#.....#.#...#.....#...#.#...#.#.#...#.#.....#...#.#...#.#...#.#...#.#.#O#.#.........#.....#.#
  // #.#####.###.#.#########.#.#.#############.#####.#.#####.#.#.#####.###.#.#####.#.###.#.#####.#.#.#.###.#.###.#.###.###.#O#.#.#############.#.#
  // #.....#.......#.........#.#.#.....#.....#.#...#.......#...#...#...#...#...#...#...#.#.....#...#...#...#...#.#...#.....#O#.#.......#.....#...#
  // #####.#####.###.#########.#.#.###.#.#####.#.#.#.#############.#.###.#####.#.#####.#.#####.#######.#.#####.#.###.#######O#########.###.###.#.#
  // #.....#.#...............#.#.#.#...#...#...#...#.#.........#...#.......#...#.#.#...#.#...#.#.......#.#...#...#.#...#....OOO....#.#.....#...#.#
  // #.#####.#.#.###.#.#####.#.#.#.#.###.#.#.###.#.###.#######.#.#########.#.###.#.#.###.#.#.#.#.#####.#.#.#.#####.###.#.#####O###.#.#####.#.#####
  // #...#.....#...#.#.#...#.#.#.#.#.#...#.#.#...#...#.....#.#...#.......#.#.#...#.#...#.#.#...#.....#.#.#.#.......#.......#OOO#.........#.#.....#
  // ###.#####.#.#.#.#.#.###.#.#.#.#.#####.#.#.#.###.###.#.#.###.#.#####.###.#.###.###.#.#.#########.#.###.#######.#.#######O#############.#####.#
  // #...#...#...#.#.#.#...#.#...#.#.#.....#.#.....#...#.#.#.....#.#...#.#...#.......#.#.#.........#.#.#...#.....#.........#OOOOO#...............#
  // #.###.#.###.#.#.#.#.#.#.#.###.#.#.#####.#.###.###.#.#.###.###.#.###.#.#####.#.###.###.#.###.###.#.#.#######.#.#######.#.###O#.###########.#.#
  // #.#...#.#...#.#.#.#...#...#...#.#.#...#.#...#.#.#.#.#...#.#.#.#...#.#.....#.#.#.......#...#.#...#...#.....#.#.....#...#...#O#.#.....#.....#.#
  // #.#.###.#.#.#.#.#.#.#######.###.#.#.#.#.#####.#.#.#####.#.#.#.###.#.###.#.#.#.#.#########.#.#.###.#####.#.#.###.###.#####.#O#.#.#.###.#####.#
  // #.#.#...#.....#.#...#.......#.#.#...#.#.....#.#...#...#.#...#.....#.#...#.#.#.#.#.........#.#...........#.#...#.....#...#.#O#.#.#.#...#.....#
  // #.#.#.###.#.###.###.#.#######.#.#####.#####.#.#.###.#.#.#######.#.#.#.#.#.#.#.#.#.#########.#.###########.###.#######.#.#.#O#.###.#.###.#####
  // #.#.#.#.......#.#...#.#.......#.....#.....#...#.#...#...#.......#...#.#...#.#.#.#.........#.......#.....#.............#...#OOOOOOO#...#.....#
  // #.#.#.#.###.###.#.###.###.#########.###.#######.###.###.#.#######.#.#.#####.#.#.#####.#####.#.#####.###.###.#.###################O###.#####.#
  // #.#.#.#.#.#.....#...#...#.........#...#.........#...#.....#.....#.#.#.....#.#.......#.#.....#.#.....#...#.#.#.....#...#...#.....#O#...#...#.#
  // #.#.#.#.#.#.###.#######.#.###.###.###.#.#########.###.#####.###.#.#######.#.#########.#.###.###.#####.#.#.#.#####.#.#.#.#.#.###.#O#.###.#.#.#
  // #...#.#...#.#...#.....#.#.#...#.#.#.#.#.....#.....#...#...#.#.#.#.......#.#.......#...#...#.#...#...#.#.....#...#.#.#...#.#.#....O#...#.#...#
  // #.###.#.###.#####.###.#.###.###.#.#.#.#####.#.###.#.###.#.#.#.#.###.#####.#######.#.#####.#.#.#####.#.###.#.#.###.#######.#.#####O###.#.#####
  // #.#...#.....#.....#.#...#.......#...#.....#.#.#...#.....#...#.............#...#...#.#...#.#...#.....#...#.#.#.....#.......#...#OOO#...#.....#
  // ###.#####.#.#.#####.#####.###.#.###.#####.#.###.#.#####.#.#######.###.#####.#.#.###.#.###.#.#.#.###.###.###.#####.#.#####.###.#O#X#.#.#####.#
  // #...#...............#.....#...#.#.....#...#.....#.#.....#.....#...#...#.#...#.#.......#.....#.#.#.#.#.#.#...#...#...#.....#...#OXX..#...#...#
  // #.#####.#####.#.#.#.#.#.#####.###.#####.#######.###.#########.###.#.###.#.#.#.#.#######.###.#.#.#.#.#.#.#.###.#.#######.###.###O#X###.###.###
  // #.....#.......#.#.#.#...#...#.#...#.....#.......#...#.......#...#.#.#.....#.#.....#.....#.#.#.#.#.#.....#.....#.......#...#.#..O#X..#...#...#
  // #.###.###.#######.#.#.###.#.#.#.###.#############.#########.###.###.#####.#.#######.#####.#.#.#.#.###.#.###.#########.#.###.#.#O#X#.#.#.###.#
  // #...#...#.#.....#.#.#.....#.....#...#.......#.....#...........#.....#...#.#...#.....#...#...#.#.#...#.#.....#.......#.#.#...#..O#X#...#...#.#
  // #.#####.#.###.#.#.#.#######.#####.###.#####.#.#####.#####.###.#####.#.#.#####.#.###.#.#.#####.#.#.###.#######.#####.#.#.#.###.#O#X###.###.#.#
  // #.............#...#...#.....#.....#...#.....#.#.......#.#.....#.#.....#.....#.#.#...#.#...#.....#...#.......#...#.#.#.#.#.#.#.#O#X#.....#.#.#
  // ###.#####.###########.#.###.#.#####.#.#.#####.#######.#.#####.#.#.#.#######.#.#.#####.###.#.#######.###.#####.#.#.#.#.###.#.#.#O#X#.#.###.#.#
  // #...#...#.#...#.....#...#.#.#.....#.#.#.....#.........#.......#...#.#.........#.........#...#...........#...#.#.#.#.#.....#...#OXX..#.....#.#
  // #.###.#.###.#.#.###.#####.#.###.#.#.#.#####.#.#.#########.#######.#.#.#######.###########.###.###.#.#####.#.###.#.#.###.###.#.#O#X###.###.#.#
  // #.#...#.#...#...#...#.#...#...#.#...#.....#.......#.....#.......#.#.#.........#.....#...#...#.#...#.#...#.#.....#...#...#...#..OXX........#.#
  // #.#.###.#.#######.###.#.#.###.#.#.###.#.#######.#.#.###.#######.#.#.#####.#####.###.#.#.#.###.#.###.#.#.#.#########.#####.#.###O#X#.###.#.#.#
  // #.#...#...#.......#.#...#.........#.#.#.....#...#...#.#...#...#.#.#...#.#.#...#.#.#...#.#.#...#...#.#.#.#.........#.......#.#..O#X#.#...#.#.#
  // #.###.#####.#####.#.#.#########.#.#.#.#####.#.#######.###.#.#.#.#.###.#.#.#.#.#.#.#####.###.#####.#.#.#.#########.#########.#.#O#X#.#.#####.#
  // #.#...#...#...#.....#...#.......#.#...#...#...#.....#...#.#.#.#.#...#.#...#.#...............#...#.#...#.#.#.....#.#.......#...#OXX#.#.......#
  // #.#.#####.###.#.#.#.###.#.#######.#.###.#.#######.#.#.#.#.###.#.###.#.#.###.#########.#######.#.#.#####.#.#.###.#.#.###.#######O#X#.###.#####
  // #.#.........#...#.#...#...#.#.....#...#.#.........#...#.#...#.........#.#...#.......#...#.....#.#.....#...#.#.....#...#.#...#..OXX#...#.#...#
  // #.#.#######.###.###.#.#####.#.#######.#.###############.###.#####.#######.#####.###.#.#.#.#####.#####.#####.#.#######.###.#.#.#O#####.#.#.#.#
  // #.#.......#...#.....#.........#.#.......#...#.....#.....#.#.....#.#.....#...#...#.....#.#.#...#.#...#.#.....#.......#.#...#...#O....#.#.#.#.#
  // #.#.#####.#.#######.#.#.#####.#.#.#######.#.#.#.###.#####.#####.#.#.###.###.#.#######.#.#.###.#.###.#.#.###.#####.#.#.#.#######O###.#.#.#.#.#
  // #.#.....#...#.......#.#.#.....#.#.#.#.....#...#.....#.........#.#.#...#.#...#.....#...#...#...#.....#.#...#.#.....#.#...#.....#O..#...#.#.#.#
  // #.#.###.#####.#######.###.#####.#.#.#.#.#.#.#.#####.###.#.###.#.#.###.#.#.#######.#.#######.###.#####.#.#.###.#####.#.###.#.#.#O#.#####.#.#.#
  // #.....#...#.........#.....#...#.....#...#...#...#.....#.#.#...#.#.#...#.#.#.......#...#.........#.....#.#.....#...#.#...#.#....O..........#.#
  // ###.#####.#.#####.#.#####.#.#.#######.#.###.###.###.#.#.#.#.#.#.###.###.#.#.#########.#.#####.#.#.#####.#########.#.###.#.###.#O#.###.###.###
  // #...#.............#.#...#...#.....#...#.#.#...#.....#...#...#.#...#.#.#.#.....#.....#.......#...#.#...#.#...#...#.#...#.#.#...#O#...#...#...#
  // #.#.#.#.###########.#.#.#########.#.#.#.#.###.#########.#.#.#.###.#.#.#.#.###.#.###.#####.#######.#.#.#.#.#.#.#.#.###.#.#.#.###O###.###.###.#
  // #.#.#...#.#.......#...#...#...#...#.#.#.#...#...#.........#.....#.#...#.....#.....#.#...#.#.......#.....#.#...#...#...#.#......O..#.....#...#
  // #.#.###.#.#.#####.#######.#.###.###.#.#.###.###.#########.#######.###.#####.#######.#.#.###.#######.#####.#######.#.###.###.###O#####.###.#.#
  // #.....#...#...#...........#...#...#.#...#.....#.#.....#...#...#...#...#...#...#.....#.#.....#...#...#.#.....#.....#.#.#...#.#..OOOOO#...#.#.#
  // ###.#.#.#.###.#############.#.###.#.#####.###.#.#.###.###.#.#.#.###.#####.###.#.###.#.#########.#.###.#.###.#.#####.#.###.###.#####O###.#.#.#
  // #.....#...#.#.......#.....#.#...#...#.....#...#...#...#...#.#.#.#...#.#...#.....#...#.....#.....#.#.#...#.#.#...#.#.#...#.....#...#O#.#...#.#
  // #.#.#.#.###.#######.#.###.#.###.#####.#####.#######.###.#.#.#.#.#.###.#.#############.###.#.#####.#.#.###.#.###.#.#.#.#########.###O#.#####.#
  // #.#...#.....#.......#.#.#...#.#.......#...#.....#...#...#...#...#...#.#.........................#.#...#...#.#...#.#.#.....#OOOOOOOOO#.....#.#
  // #.#.#.#.###.#.#######.#.#####.###.#####.###.#.#.#.###.#########.###.#.#####################.###.#.#.#.#.###.#.###.#.#.#.###O#########.#.###.#
  // #...#...#...#.....#...#.........#...#.........#.#.#...........#.#...#.....#.......#.......#...#...#.....#...#.....#.#.#...#O#OOO#.#...#.....#
  // #.#.#.#.#.#######.#.###.###.###.###.###########.#.###.#.###.#.#.#.###.###.#####.#.#.#####.#.#####.#####.#.###.#####.#####.#O#O#O#.#.#########
  // #.............#...#.#.....#...#.#.#.......#.....#.....#.........#...#.#.........#...#...#.#.#...#.........#...#...#.....#..OOO#O#...#.......#
  // ###.#.#######.#.###.#.#######.#.#.#######.#############.###########.#.#####.#########.#.#.###.#.###########.###.#.###.#.#.#####O#.#.#######.#
  // #.#.....#...#.#...#.#...#.....#.......#.#.#...................#...........#.#.....#...#.#.....#...#...#.......#.#...#.#.....#.#OOO#.....#...#
  // #.###.#.#.#.#.###.#.#####.###########.#.#.#.#.#.###############.#.###.###.###.###.#.#####.#######.#.#.#.###.###.###.#######.#.###O#####.#.#.#
  // #.....#.#.#.....#.#.......#.............#.#...#.#...#.....#.....#...#.........#...#...#.........#...#.#.#...#...#...#.......#...#O....#.#.#.#
  // ###.#.#.#.#######.#.#.###.#.#.###########.#.#.#.#.#.#.###.#.#####.#.###.#######.###.#.#.#.#####.#####.###.#.#.###.###.#######.###O###.#.#.#.#
  // #...#.#.#...#.....#...#...#.#.........#...#.#...#.#.#.#.#...#.#...#.....#.....#...#.#...#.#...#.#...#...#.#.#...#...#............O..#.#...#.#
  // #.###.#.###.#.#########.###.#####.#.#.#.#.#.###.###.#.#.#.###.#.###########.#####.#.#####.#.###.#.#.###.#.#.###.###.#.###.#.#####O#.#.#######
  // #...#.#.#...#.....#...#.#...#.....#.#.#.#.....#.....#...#...................#...#.#.#...#.#.....#.#...#...#.....#.#.#...#.#.....#O#.#.......#
  // #.#.###.#.#.#####.#.#.#.#.###.#####.#.#.#####.#.#######.#####.#######.#######.#.#.#.#.#.#.#######.###.#####.#.###.#.#####.#####.#O#########.#
  // #.#...#...#...#.#...#...#...#.#.....#.#...#...#.#.....#.#.......#...#.#...#...#.#.#.#.#.#...#.....#.......#.#...#.....#...#.....#O#.........#
  // #.###.#######.#.#######.#.#.#.#.#####.###.#.###.#.###.#.#.#####.#.#.###.#.#.###.#.#.#.#.###.#.#####.#####.#.#.#.#####.#.###.#####O#.#########
  // #.#...#...#.......#...#.#.#.#.......#.......#.....#...#...#...#...#...#.#.#...#...#...#.#...#.#...#...#...#.#.#...#.....#.#......O..#.......#
  // ###.###.#.#.#######.#.#.###.#######.#####.#.#.#####.#######.#.#######.#.#.###.#######.#.#.###.#.#####.#.###.#####.#.###.#.#.#.###O#####.###.#
  // #...#...#...#.......#...#...#.....#.......#.#.....#.........#.#...#...#.#.#...#.....#...#.....#.#.....#...#.#.....#.......#.#....O....#.#...#
  // #.###.#######.###########.#.#.###.#########.#.#####.#.###.###.#.#.#.###.#.#.#.#.###.#.#########.#.#########.#.#####.#####.#.#.###O###.###.#.#
  // #.....#.......#...........#.#...#...........#.#.......#...#...#.#.#...#.#.#.#.#...#.#.#.........#...#.......#.....#.#.......#...#O#.#.....#.#
  // #.#####.###.#####.#####.#######.#############.#.#######.#.###.#.#####.#.#.#.#####.#.#.#.#######.###.#.#######.###.#.###.###.#.###O#.#######.#
  // #.....#...#.#...#...#.#...#.....#.............#.........#...#...#...#.#.#...#.....#.#.#.#.....#.#.........#...#...#...#.#...#.#..O#.....#...#
  // #####.###.###.#.###.#.###.#.#####.#####.#.#.###############.#.###.#.#.#.#####.#####.#.#.#.#####.#.#######.###.#.#####.#.#.###.#.#O#####.#.###
  // #...#...#.....#.#.#.#.#...#...........#.#.#.............#...#.#...#...#.....#.....#.#...#.#...#.#...#...#...#.#.#.....#.#.#...#..O#.....#...#
  // ###.###.#######.#.#.#.#.#####.#######.#.#.#.###########.#.#####.#######.###.#####.#.#####.#.#.#.###.#.#.###.###.###.###.#.#.#####O#.#######.#
  // #.....#.....#...#.#.#.#...#...........#.#.#.#.....#...#...#.....#...#.#.#.#.......#...#.#...#.....#...#...#...#...#...#.#.#.#...#O#.#.......#
  // #.#######.#.#.###.#.#.###.#.#.###.#######.###.###.###.###.#.#####.#.#.#.#.###.#######.#.#.#############.#.###.#.#.#.#.###.#.#.###O#.#.#######
  // #.........#.#.#.......#.#...#...#.......#.#...#...#...#...#.......#.#.........#.....#.#...#...#.........#...#...#.#.#.....#...#..OOO........#
  // #.#########.#.#######.#.#######.#######.#.#.###.###.###.###########.#########.#.#.###.#.###.#.#.#####.#.#.#.###.#.#####.###.###.#.#O#######.#
  // #.....#.....#.#...#...#.......#.#.....#.#...#...#...#...#.....#...#.....#...#.#.#.#...#.....#...#...#.#.#.#.#.#.#.....#...#.#...#.#O#.......#
  // #####.#.###.#.#.#.#.###.#####.#.#.###.#.#.###.###.#.#.###.#.#.###.###.#.#.###.#.###.###.#########.###.###.#.#.#.#####.###.###.###.#O#.#.###.#
  // #...#...........#.#.#...#.....#.#.#.#...#...#.#...#...#...#.#.....#.#.........#.#...#...#OOO#.....#.......#...#.#.....#.......#...#OOOOO....#
  // #.#.#####.#.#####.#.###.#.#####.#.#.#######.#.#######.#####.#####.#.#.###.#####.#.#.#.#.#O#O#.###.#.#######.###.#.#.#############.#.###O###.#
  // #.........#.#...#.#.#...#.#...#...#.......#.#...#...#.........#.....#.#...#.....#.#...#.#O#OOO#.....#.....#.#...#.#.#.....#.......#...#OOO#.#
  // #.#####.###.#.###.#.#.###.#.#.#.#####.###.#.###.#.#.#########.#.#.###.#.###.#####.#.#####O###O#.#.#.#.###.###.###.###.###.#####.#####.#.#O###
  // #...............#.#...#...#...#.......#...#...#...#...#.......#.#.....#.#...#.....#.#OOOOO..#O#.#.#.#.#.....#...#.....#.#.#...#.......#.#OOO#
  // #.#.#.###.###.#.#.#########.#.#########.#####.#######.#######.#.#.#####.#.#.#.#####.#O#######O#.###.#.#.###.###.###.###.#.#.#.#####.#######O#
  // #.#.#...#.#...#.#.#.......#.#.........#...#.......#.#.......#.#.#.#...#...#.#.#.....#O#OOOOOOO#.....#.#...#...#...#.....#...#.....#.#.....#O#
  // #.#.#####.#.###.#.#.#####.#.#########.###.#.#####.#.#######.#.#.#.#.#.#.#####.#.#####O#O#######.#####.###.#.#####.#####.#########.#.#.###.#O#
  // #.#.#...........#...#...#...#.......#.#.#.#.#...#...#...#...#.......#...#...#.#OOOOOOO#O#...#.....#.............#...#...#.........#...#.#.#O#
  // #.#.#.#.#.#####.#####.#######.#.#####.#.#.###.#.###.#.#.#.###.#######.#.#.#.#.#O#######O#.#.#######.#########.#####.#####.#############.#.#O#
  // #.#...#.#.#.......#...#.......#.#.......#.#...#.#.....#.#.#.#.#...#...#.....#.#O#.....#O..#...#.....#...#...#.....#.#.....#.........#...#.#O#
  // #.###.#.#.#.#####.###.#.###.#.###.#####.#.#.###.#########.#.#.###.#.###.###.#.#O#.#####O#####.#.#####.#.#.#.#####.#.#.#####.#.#######.#.#.#O#
  // #.....#.#.#...#...#...#...#.#.#...#.........#.......#.....#.#.....#...#.#.#...#OOO#OOOOO....#.#.#...#.#...#...#...#.#.#...............#....O#
  // #.###.#.#.#.#.#.#.#.#####.#.###.###.###############.#.#####.###.#####.#.#.#######O#O#######.#.#.#.###.#######.#.#.#.#.#.#####.#########.###O#
  // #.....#...#.#...#.#.....#...#...#.....#...........#...#.......#.#.....#.#.......#O#O#OOO#.....#.#.#...#.......#.#.#...#.#...#.#...#.......#O#
  // #.###.#########.#.###.#.#.#.#.#.#######.#########.#.#######.###.#.#####.###.#####O#O#O#O#.#####.#.#.#####.#####.###.###.#.#.#.#.###.###.###O#
  // #.#.............#...#.#...#...........#.#.#.....#.#.#...#...#...#.......#...#OOOOO#OOO#O#.#...#...#.....#...#.....#.....#.#.#...#...#...#OOO#
  // #.###.#.###.#######.#.#####.###.#####.#.#.#.###.#.###.#.#.###.###########.###O#########O###.#.#.#.#####.###.#####.#.#####.#.#####.#######O###
  // #...........#.......#.#.....#.#.....#...#.#...#.#.....#.#.....#...#.....#OOOOO#.......#O#...#...#.....#.#.........#.#...#.#.....#.#OOOOOOO#.#
  // #.###.#####.###.#.#.###.###.#.#.###.#####.#.###.#.#####.#.#####.#.#.###.#O#########.#.#O#.#########.###.#.#######.#.###.#.#####.#.#O#######.#
  // #.#...#.....#...#.#.....#...#.#.#.......#...#...#.....#.#.....#.#...#...#O#.......#.#.#OOOOOOOOO#...#...#.#.....#.#.....#...#.....#O#.......#
  // #.#.#.#.#####.###.#######.###.#.#.###.###.###.#.#.#####.#####.#.#######.#O#.#.###.#.#.#########O#.#.#.#.###.###.#.#####.###.#.###.#O#.#.#####
  // #.#.....#.....#...#XXOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO#.#.#...#.#...#...#..O..#.#.#.....#...#.#...#..XXXXOOOOOOO..#.#...#
  // #.###.###.#####.###X#O###.#######.###.#.#.###.###.#.#####.#.#####.#########.#.###.#.###.#.#.###O#.###.#.#####.#####.#.###X###O#.###.#.###.#.#
  // #.........#.#.....#X.O#...#.....#.#...#...#...#...#...#...#...#...#.......#.#...#...#...#......O..............#OOOOOOOOOOOOOOO#.....#.....#.#
  // ###.#######.#.###.#X#O#.###.###.#.#.#.#.###.#.#.#.#.#.#.#####.#.#######.#.###.#.#########.###.#O###.###.#.#####O#.#.#.###.#.#.###########.#.#
  // #...#..OOOOOOOOOOOOOOO......#.#.#.#.#.....#.............................#...#.#.......#...#....O....#...#.#OOOOO#...#...#...#...#.......#.#.#
  // #.#####O#######.#.###.#######.#.###.#.#.#.#.###.#.###.#####.#.###.#########.#####.###.#.###.###O###.#.#.#.#O###########.#####.#.#.#.###.###.#
  // #XXOOOOO....#...#...#.........#.....#...#.#.#...#.....#...#.#.......#.......#...#.#...#.#......OOOOOOOOOOOOO....#.....#...#...#.#.#.#.#.#...#
  // #X#O#.#.#.#.#.#####.###.#############.#.#.#.#.#####.###.#.#.#####.#.#.#######.#.###.#.#.#######.#.#####.#.#####.#.###.#.#.#.#.#.#.#.#.#.#.#.#
  // #X#O#.#...#...#...#.......................#.#...#...#...#.#.#.......#.........#.....#.#.....#...#.......#...#...#.....#.....#...#.#.#.#.#.#.#
  // #X#O#.#########.#.#.#.###.#.###.#####.#.#.#.###.#####.###.#.#.###.###################.#####.#.#.###########.#.#######.#.#####.#####.#.#.#.#.#
  // #OOO#...........#.......#.....#...............#.........#...#.............................#...............#...........#.............#.....#.#
  // #############################################################################################################################################

  print(tiles.length + 38 /* X counted by hand */);
}

sealed class Node {}

class Path extends Node {
  bool start = false;
  bool end = false;
}

class Wall extends Node {}
